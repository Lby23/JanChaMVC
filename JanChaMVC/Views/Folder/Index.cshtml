
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout1.cshtml";
}
<script src="~/layui-v2.5.7/layui/layui.js"></script>
<link href="~/layui-v2.5.7/layui/css/layui.css" rel="stylesheet" />
<h1>栏目管理</h1>
<!-- 搜索栏 -->
<div class="layui-form-item demoTable" style="margin-top:5px;">
    <div class="layui-inline">
        <div class="layui-input-inline">
            <input id="folname" autocomplete="off" class="layui-input" placeholder="请输入名称">
        </div>
    </div>
    <div class="layui-inline">
        <div class="layui-input-inline">
            <select id="status"  class="layui-input" lay-filter="aihao">
                <option value="0">-请选择-</option>
                <option value="1">显示</option>
                <option value="2">隐藏</option>
            </select>
        </div>
    </div>
    <button class="layui-btn layui-btn-primary" id="btncha"><i class="layui-icon">&#xe615;</i>查询</button>
    <button class="layui-btn layui-btn-primary" id="btnchong"><i class="layui-icon">&#xe9aa;</i>重置</button>
    <button class="layui-btn layui-btn-primary" id="btnzeng" data-type="auto"><i class="layui-icon">&#xe654;</i>新增</button>
</div>
<table class="layui-hide" id="test"></table>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
    layui.use('table', function () {
        var table = layui.table;

        table.render({
            elem: '#test',
            url: 'http://localhost:64502/api/Folder/Index',
            method: 'post',
            cols: [[
                { field: 'zizeng', width: 80, title: '排名', fixed: 'left', sort: true, templet: '#zizeng' },
                { field: 'parentId', width: 90, title: '编号' },
                { field: 'name', width: 120, title: '名称', sort: true },
                { field: 'key', width: 120, title: 'urlkey', sort: true },
                { field: 'path', title: '模板路径', minWidth: 85 },
                { field: 'sort', width: 60, title: '排序' },
                { field: 'status', width: 110, title: '状态' },
                { field: 'type', width: 110, title: '类型' },
                { field: 'jumpUrl', width: 110, title: '地址' },
                { field: 'content', width: 110, title: '说明' },
                { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 165 }
            ]],
            page: true,
            limit: 5,
            limits: [5, 10, 15],
            request: {
                pageName: 'page',//控制器 显示方法 当前页数参数
                limitName: 'limit' //控制器 显示方法 每页条数参数
            },
            id: 'testReload'
        });

        var $ = layui.$;

        //监听行工具事件
        table.on('tool(test)', function (obj) {
            var data = obj.data;
            //console.log(obj)
            if (obj.event === 'detail') {
                layer.open({
                    type: 1
                    , title: '查看栏目信息'
                    , content: $('#create')
                    , width: '500px'
                    , area: ["800px", "600px"]
                    , btn: ['提交', '关闭全部']
                    , btnAlign: 'c' //按钮居中
                    , shade: 0 //不显示遮罩
                    , success: function () {
                        //反填数据
                        $('[name="sort"]').val(data.sort);
                        //alert(data.folderId);
                        if (data.status == 1) {
                            $("#status1").prop('checked', true)
                        } else if (data.status == 2) {
                            $("#status2").prop('checked', true)
                        };
                        if (data.isComment == 1) {
                            $("#isComment1").prop('checked', true)
                        } else if (data.isComment == 2) {
                            $("#isComment2").prop('checked', true)
                        };
                        if (data.isRecommend == 1) {
                            $("#isRecommend1").prop('checked', true)
                        } else if (data.isRecommend == 2) {
                            $("#isRecommend2").prop('checked', true)
                        };
                        $('[name="startTime"]').val(data.startTime);
                        $('[name="endTime"]').val(data.endTime);
                        $('[name="type"]').val(data.type);
                        $('[name="jumpUrl"]').val(data.jumpUrl);
                        $('[name="image"]').val(data.image);
                    }
                });
            } else if (obj.event === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    $.ajax({
                        url: 'http://localhost:64502/api/Folder/Del',
                        type: 'delete',
                        data: '"' + data.id + '"',
                        dataType: "json",
                        contentType: "application/json",
                        success: function (result) {
                            if (result > 0) {
                                alert("删除成功！");

                            }
                            else {
                                alert("删除失败！")
                            }
                        }
                    });
                    location.reload();
                });
            } else if (obj.event === 'edit') {
                layer.prompt({
                    formType: 2
                    , value: data.email
                }, function (value, index) {
                    obj.update({
                        email: value
                    });
                    layer.close(index);
                });
            }
        });

        //重载查询
        $('#btncha').on('click', function () {
            table.reload('testReload', {
                where: { //设定异步数据接口的额外参数，任意设
                    folname: $('#folname').val(),
                    status: $('#status').val()
                }
                , page: {
                    curr: 1 //重新从第 1 页开始
                }
            }); //只重载数据
        });
        //重置
        $('#btnchong').click(function () {
            $('#folname').val(""),
                $('#status').val(0);
        })

        //新增弹出方法
        $('#btnzeng').click(function () {
            layui.use('layer', function () {
                var layer = layui.layer;
                //在这里面输入任何合法的js语句
                layer.open({
                    type: 2,
                    skin: 'layui-layer-rim', //加上边框
                    title: '栏目添加',
                    anim: 3,
                    area: ['800px', '500px'], //宽高
                    content: 'http://localhost:65188/Folder/Add',
                    success: function (layero, index) {
                        console.log(layero, index);
                    }
                });
            })
        })
    });
</script>
