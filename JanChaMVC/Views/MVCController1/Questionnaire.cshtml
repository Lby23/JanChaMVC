
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="~/layui-v2.5.7/layui/css/layui.css" rel="stylesheet" />

    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo">layui 后台布局</div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item"><a href="">首页</a></li>
                <li class="layui-nav-item"><a href="">黑名单</a></li>
                <li class="layui-nav-item"><a href="">举报投诉</a></li>
                <li class="layui-nav-item"><a href="">招聘管理</a></li>
                <li class="layui-nav-item"><a href="">问卷管理</a></li>
                <li class="layui-nav-item">
                    <a href="javascript:;">内容管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">栏目管理</a></dd>
                        <dd><a href="">栏目公告</a></dd>
                        <dd><a href="">栏目滚动图片</a></dd>
                        <dd><a href="">文章管理</a></dd>
                        <dd><a href="">文章审核</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">其他管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">友情链接</a></dd>
                        <dd><a href="">访问量统计</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">系统管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">用户管理</a></dd>
                        <dd><a href="">日志管理</a></dd>
                        <dd><a href="">角色管理</a></dd>
                    </dl>
                </li>
            </ul>
        </div>

    </div>
    <div class="layui-form-item" style="margin-left:5px;margin-top:3px;margin-bottom:3px">
        <div class="layui-inline" style="margin-top:3px">
            <input class="layui-input" name="title" id="tl" placeholder="请输入标题">
        </div>
        <button type="button" class="layui-btn" id="seach">搜索</button>
        <button class="layui-btn">重置</button>
        <button class="layui-btn" onclick="Add()">新增</button>
    </div>
    <div id="xia" hidden="hidden">
        <form class="layui-form">
            <div class="layui-form-item">
                <label class="layui-form-label">问卷标题</label>
                <div class="layui-input-block">
                    <input type="text" name="Title" required lay-verify="required" placeholder="问卷标题" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">开始描述</label>
                <div class="layui-input-block">
                    <textarea name="BeginMs" class="layui-textarea"></textarea>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">结束描述</label>
                <div class="layui-input-block">
                    <textarea name="EndMs" class="layui-textarea"></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">问卷状态</label>
                <div class="layui-input-block">
                    <input type="radio" name="Qsale" value="true" title="启用">
                    <input type="radio" name="Qsale" value="false" title="禁用" checked>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="add" id="for" type="submit">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
    <!-- 内容主体区域 -->
    <table id="demo" lay-filter="test" width="100%"></table>
    <script src="~/layui-v2.5.7/layui/layui.js"></script>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <script type="text/html" id="barDemo">
        <button type="button" class="layui-btn layui-btn-xs layui-btn-xs">修改</button>
        <button type="button" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</button>
        <button type="button" class="layui-btn layui-btn-normal layui-btn-xs">推钉钉</button>
        <button type="button" class="layui-btn layui-btn-normal layui-btn-xs">推邮箱</button>
    </script>
    <script type="text/html" id="barDemo1">
        <button type="button" class="layui-btn layui-btn-xs  layui-btn-xs">新增题目</button>
    </script>
    <script type="text/html" id="barDemo2">
        <button type="button" class="layui-btn layui-btn-normal  layui-btn-xs">查看</button>
    </script>
    <script>
        var layer = layui.layer;
        var form = layui.form;
        layui.use('table', function () {
            var table = layui.table;

            //第一个实例
            var tb = table.render({
                elem: '#demo'
                , height: 312
                , id: 'eno'
                , method: 'get'
                , url: 'http://localhost:64502/api/Questionnaire' //数据接口
                , page: true //开启分页
                , cols: [[ //表头
                    { field: 'quesId', title: '序号', width: 200, sort: true, fixed: 'left' }
                    , { field: 'sno', title: '问卷编号', width: 200 }
                    , { field: 'title', title: '问卷标题', width: 200 }
                    , { field: 'qsale', title: '问卷状态', width: 200 }
                    , { field: 'snum', title: '回收数量', width: 200 }
                    , { field: 'createTime', title: '创建时间', width: 200 }
                    , { field: 'createPeople', title: '创建人', width: 200 }
                    , { fixed: 'right', title: '新增题目', toolbar: '#barDemo1', width: 138 }
                    , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 270 }
                    , { fixed: 'right', title: '查看邮件', toolbar: '#barDemo2', width: 100 }
                ]]
            });
            //查询
            $("#seach").click(function () {
                var tle = $("#tl").val();
                tb.reload({
                    where: { //设定异步数据接口的额外参数，传的条件
                        title: tle
                    }
                    , page: {
                        curr: 1 //重新从第 1 页开始
                    }
                });
            });


            //监听行工具事件
            table.on('tool(test)', function (obj) {
                var data = obj.data;
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                //console.log(obj)
                if (layEvent === 'del') {
                    layer.confirm('真的删除行么', function (index) {
                        $.ajax({
                            url: 'http://localhost:64502/api/Questionnaire/delete?id=' + data.quesId,
                            type: 'Delete',
                            success: function (result) {
                                if (result > 0) {
                                    layer.msg("删除成功！");
                                    tb.reload();//重载表格
                                }
                                else {
                                    layer.msg("删除失败！");
                                }
                            }
                        });
                    });
                }
                //else if (obj.event === 'edit') {
                //    layer.prompt({
                //        formType: 2
                //        , value: data.email
                //    }, function (value, index) {
                //        obj.update({
                //            email: value
                //        });
                //        layer.close(index);
                //    });
                //}
            });
        });

        function Add() {
            lx=layer.open({
                type: 1,
                area: ['500px']
                , title: "新增问卷"
                , content: $('#xia') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
            });
        }
            
            form.on('submit(add)', function (data) {
                console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
                console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
                console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}
                $("#for").click(function () {
                    $.ajax({
                        url: 'http://localhost:64502/api/Questionnaire/Add',
                        type: 'post',
                        data: JSON.stringify(data.field),
                        success: function (result) {
                            if (result > 0) {
                                layui.msg("添加成功!");
                                layui.close(lxx);
                                tb.reload();
                            }
                            else {
                                layui.msg("添加失败!");
                            }
                        },//dataType: "json",
                        contentType: "application/json"
                    });
                });
                return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            });
        



        //JavaScript代码区域
        layui.use('element', function () {
            var element = layui.element;

        });

        layui.use('element', function () {
            var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

            //监听导航点击
            element.on('nav(demo)', function (elem) {
                //console.log(elem)
                layer.msg(elem.text());
            });
        });
    </script>
</body>
</html>

